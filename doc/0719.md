# 오늘의 목표 🥝

- ✅ 장바구니페이지 결제 Flow 구현
- 결제 성공. 근데 돈은 안빠져나감.
	- 결제이후 주문정보 서버 db에 저장하면 큰 틀은 끝남.

## 오늘의 업무일지

주문정보 객체를 명확히 설계해서 잘 저장해 둬야 할듯하다.
주문정보를 토대로 주문db에 삽입하면 일사천리 일듯?

1. 플러터에서 Buy버튼 클릭시 [상품 * 개수]의 배열도 같이 서버로 보낸다.

2. 서버에서는 주문정보 metadata에 해당 배열을 같이 저장

3. 토스 결제승인 성공시 주문정보를 통해 db 저장.

# 비상! 🚨

- 갑자기 토스페이먼츠 결제위젯에서 결제하기 버튼누르니까 반응이 없다.
- 에뮬레이터의 웹뷰로는 개발자도구 접근이 어렵다.
- 브라우저로 직접 들어가보자.
- 결제위젯 페이지에 접근하기 위해 필요한 인자를 url에 query로 명시하여 입력했다.
- 역시 브라우저 환경에서도 결제하기 버튼이 먹통이었고 개발자도구의 console란에서 오류를 확인
- 오류 문구는 다음과 같음.
payment-widget:1 Uncaught (in promise) Error: `orderId`는 영문 대소문자, 숫자, 특수문자(-, _) 만 허용합니다. 6자 이상 64자 이하여야 합니다.

오류를 확인하지 못했다면 절대 몰랐을 듯하다.
웹뷰에서도 이런 오류를 검출할 수 있으면 좋을 것 같다.

OrderId 123456으로 진행했는데도 또 결제버튼이 먹통이다.

Uncaught (in promise) Error: 이미 승인 및 취소가 진행된 중복된 주문번호 입니다. 다른 주문번호로 진행해주세요.

아, 아까전에 결제승인 API를 통해 주문이 성공했기때문에 동일한 orderId로는 안되는구나.

❓ db에 들어간 정보도 아닌데 어떻게 매번 orderID를 발급받지??
- 여러명이 동시에 주문했다가 orderID가 중복으로 발급되면???
